function q(r){for(var e=r.length,t=0,i=0;i<e;){var n=r.charCodeAt(i++);if(n&4294967168)if(!(n&4294965248))t+=2;else{if(n>=55296&&n<=56319&&i<e){var s=r.charCodeAt(i);(s&64512)===56320&&(++i,n=((n&1023)<<10)+(s&1023)+65536)}n&4294901760?t+=4:t+=3}else{t++;continue}}return t}function X(r,e,t){for(var i=r.length,n=t,s=0;s<i;){var o=r.charCodeAt(s++);if(o&4294967168)if(!(o&4294965248))e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<i){var f=r.charCodeAt(s);(f&64512)===56320&&(++s,o=((o&1023)<<10)+(f&1023)+65536)}o&4294901760?(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128):(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128)}else{e[n++]=o;continue}e[n++]=o&63|128}}var G=new TextEncoder,Y=50;function b(r,e,t){G.encodeInto(r,e.subarray(t))}function $(r,e,t){r.length>Y?b(r,e,t):X(r,e,t)}var J=4096;function V(r,e,t){for(var i=e,n=i+t,s=[],o="";i<n;){var f=r[i++];if(!(f&128))s.push(f);else if((f&224)===192){var c=r[i++]&63;s.push((f&31)<<6|c)}else if((f&240)===224){var c=r[i++]&63,a=r[i++]&63;s.push((f&31)<<12|c<<6|a)}else if((f&248)===240){var c=r[i++]&63,a=r[i++]&63,u=r[i++]&63,d=(f&7)<<18|c<<12|a<<6|u;d>65535&&(d-=65536,s.push(d>>>10&1023|55296),d=56320|d&1023),s.push(d)}else s.push(f);s.length>=J&&(o+=String.fromCharCode.apply(String,s),s.length=0)}return s.length>0&&(o+=String.fromCharCode.apply(String,s)),o}var Z=new TextDecoder,Q=200;function j(r,e,t){var i=r.subarray(e,e+t);return Z.decode(i)}function ee(r,e,t){return t>Q?j(r,e,t):V(r,e,t)}var _=function(){function r(e,t){this.type=e,this.data=t}return r}(),te=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=n[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),y=function(r){te(e,r);function e(t){var i=r.call(this,t)||this,n=Object.create(e.prototype);return Object.setPrototypeOf(i,n),Object.defineProperty(i,"name",{configurable:!0,enumerable:!1,value:e.name}),i}return e}(Error),S=4294967295;function re(r,e,t){var i=t/4294967296,n=t;r.setUint32(e,i),r.setUint32(e+4,n)}function W(r,e,t){var i=Math.floor(t/4294967296),n=t;r.setUint32(e,i),r.setUint32(e+4,n)}function O(r,e){var t=r.getInt32(e),i=r.getUint32(e+4);return t*4294967296+i}function ie(r,e){var t=r.getUint32(e),i=r.getUint32(e+4);return t*4294967296+i}var ne=-1,se=4294967296-1,oe=17179869184-1;function ae(r){var e=r.sec,t=r.nsec;if(e>=0&&t>=0&&e<=oe)if(t===0&&e<=se){var i=new Uint8Array(4),n=new DataView(i.buffer);return n.setUint32(0,e),i}else{var s=e/4294967296,o=e&4294967295,i=new Uint8Array(8),n=new DataView(i.buffer);return n.setUint32(0,t<<2|s&3),n.setUint32(4,o),i}else{var i=new Uint8Array(12),n=new DataView(i.buffer);return n.setUint32(0,t),W(n,4,e),i}}function fe(r){var e=r.getTime(),t=Math.floor(e/1e3),i=(e-t*1e3)*1e6,n=Math.floor(i/1e9);return{sec:t+n,nsec:i-n*1e9}}function ce(r){if(r instanceof Date){var e=fe(r);return ae(e)}else return null}function he(r){var e=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(r.byteLength){case 4:{var t=e.getUint32(0),i=0;return{sec:t,nsec:i}}case 8:{var n=e.getUint32(0),s=e.getUint32(4),t=(n&3)*4294967296+s,i=n>>>2;return{sec:t,nsec:i}}case 12:{var t=O(e,4),i=e.getUint32(0);return{sec:t,nsec:i}}default:throw new y("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(r.length))}}function ue(r){var e=he(r);return new Date(e.sec*1e3+e.nsec/1e6)}var le={type:ne,encode:ce,decode:ue},N=function(){function r(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(le)}return r.prototype.register=function(e){var t=e.type,i=e.encode,n=e.decode;if(t>=0)this.encoders[t]=i,this.decoders[t]=n;else{var s=1+t;this.builtInEncoders[s]=i,this.builtInDecoders[s]=n}},r.prototype.tryToEncode=function(e,t){for(var i=0;i<this.builtInEncoders.length;i++){var n=this.builtInEncoders[i];if(n!=null){var s=n(e,t);if(s!=null){var o=-1-i;return new _(o,s)}}}for(var i=0;i<this.encoders.length;i++){var n=this.encoders[i];if(n!=null){var s=n(e,t);if(s!=null){var o=i;return new _(o,s)}}}return e instanceof _?e:null},r.prototype.decode=function(e,t,i){var n=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return n?n(e,t,i):new _(t,e)},r.defaultCodec=new r,r}();function I(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new Uint8Array(r):Uint8Array.from(r)}function de(r){if(r instanceof ArrayBuffer)return new DataView(r);var e=I(r);return new DataView(e.buffer,e.byteOffset,e.byteLength)}var pe=100,ve=2048,we=function(){function r(e){var t,i,n,s,o,f,c,a;this.extensionCodec=(t=e?.extensionCodec)!==null&&t!==void 0?t:N.defaultCodec,this.context=e?.context,this.useBigInt64=(i=e?.useBigInt64)!==null&&i!==void 0?i:!1,this.maxDepth=(n=e?.maxDepth)!==null&&n!==void 0?n:pe,this.initialBufferSize=(s=e?.initialBufferSize)!==null&&s!==void 0?s:ve,this.sortKeys=(o=e?.sortKeys)!==null&&o!==void 0?o:!1,this.forceFloat32=(f=e?.forceFloat32)!==null&&f!==void 0?f:!1,this.ignoreUndefined=(c=e?.ignoreUndefined)!==null&&c!==void 0?c:!1,this.forceIntegerToFloat=(a=e?.forceIntegerToFloat)!==null&&a!==void 0?a:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return r.prototype.reinitializeState=function(){this.pos=0},r.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},r.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},r.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth ".concat(t));e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)},r.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)},r.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),i=new Uint8Array(t),n=new DataView(t);i.set(this.bytes),this.view=n,this.bytes=i},r.prototype.encodeNil=function(){this.writeU8(192)},r.prototype.encodeBoolean=function(e){e===!1?this.writeU8(194):this.writeU8(195)},r.prototype.encodeNumber=function(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)},r.prototype.encodeNumberAsFloat=function(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},r.prototype.encodeBigInt64=function(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))},r.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error("Too long string: ".concat(e," bytes in UTF-8"))},r.prototype.encodeString=function(e){var t=5,i=q(e);this.ensureBufferSizeToWrite(t+i),this.writeStringHeader(i),$(e,this.bytes,this.pos),this.pos+=i},r.prototype.encodeObject=function(e,t){var i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},r.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error("Too large binary: ".concat(t));var i=I(e);this.writeU8a(i)},r.prototype.encodeArray=function(e,t){var i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error("Too large array: ".concat(i));for(var n=0,s=e;n<s.length;n++){var o=s[n];this.doEncode(o,t+1)}},r.prototype.countWithoutUndefined=function(e,t){for(var i=0,n=0,s=t;n<s.length;n++){var o=s[n];e[o]!==void 0&&i++}return i},r.prototype.encodeMap=function(e,t){var i=Object.keys(e);this.sortKeys&&i.sort();var n=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error("Too large map object: ".concat(n));for(var s=0,o=i;s<o.length;s++){var f=o[s],c=e[f];this.ignoreUndefined&&c===void 0||(this.encodeString(f),this.doEncode(c,t+1))}},r.prototype.encodeExtension=function(e){var t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},r.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},r.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},r.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},r.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},r.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},r.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},r.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},r.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},r.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},r.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),re(this.view,this.pos,e),this.pos+=8},r.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),W(this.view,this.pos,e),this.pos+=8},r.prototype.writeBigUint64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8},r.prototype.writeBigInt64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8},r}();function ye(r,e){var t=new we(e);return t.encodeSharedRef(r)}function D(r){return"".concat(r<0?"-":"","0x").concat(Math.abs(r).toString(16).padStart(2,"0"))}var xe=16,ge=16,Ue=function(){function r(e,t){e===void 0&&(e=xe),t===void 0&&(t=ge),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var i=0;i<this.maxKeyLength;i++)this.caches.push([])}return r.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},r.prototype.find=function(e,t,i){var n=this.caches[i-1];e:for(var s=0,o=n;s<o.length;s++){for(var f=o[s],c=f.bytes,a=0;a<i;a++)if(c[a]!==e[t+a])continue e;return f.str}return null},r.prototype.store=function(e,t){var i=this.caches[e.length-1],n={bytes:e,str:t};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=n:i.push(n)},r.prototype.decode=function(e,t,i){var n=this.find(e,t,i);if(n!=null)return this.hit++,n;this.miss++;var s=V(e,t,i),o=Uint8Array.prototype.slice.call(e,t,t+i);return this.store(o,s),s},r}(),me=function(r,e,t,i){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function f(u){try{a(i.next(u))}catch(d){o(d)}}function c(u){try{a(i.throw(u))}catch(d){o(d)}}function a(u){u.done?s(u.value):n(u.value).then(f,c)}a((i=i.apply(r,e||[])).next())})},M=function(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function f(a){return function(u){return c([a,u])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,n&&(s=a[0]&2?n.return:a[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[a[0]&2,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){t.label=a[1];break}if(a[0]===6&&t.label<s[1]){t.label=s[1],s=a;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(a);break}s[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(u){a=[6,u],n=0}finally{i=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},F=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=r[s]&&function(o){return new Promise(function(f,c){o=r[s](o),n(f,c,o.done,o.value)})}}function n(s,o,f,c){Promise.resolve(c).then(function(a){s({value:a,done:f})},o)}},E=function(r){return this instanceof E?(this.v=r,this):new E(r)},Ee=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(h){i[h]&&(n[h]=function(p){return new Promise(function(x,m){s.push([h,p,x,m])>1||f(h,p)})})}function f(h,p){try{c(i[h](p))}catch(x){d(s[0][3],x)}}function c(h){h.value instanceof E?Promise.resolve(h.value.v).then(a,u):d(s[0][2],h)}function a(h){f("next",h)}function u(h){f("throw",h)}function d(h,p){h(p),s.shift(),s.length&&f(s[0][0],s[0][1])}},L="array",A="map_key",Se="map_value",Te=function(r){return typeof r=="string"||typeof r=="number"},T=-1,C=new DataView(new ArrayBuffer(0)),_e=new Uint8Array(C.buffer);try{C.getInt8(0)}catch(r){if(!(r instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var k=RangeError,R=new k("Insufficient data"),Ae=new Ue,Ie=function(){function r(e){var t,i,n,s,o,f,c;this.totalPos=0,this.pos=0,this.view=C,this.bytes=_e,this.headByte=T,this.stack=[],this.extensionCodec=(t=e?.extensionCodec)!==null&&t!==void 0?t:N.defaultCodec,this.context=e?.context,this.useBigInt64=(i=e?.useBigInt64)!==null&&i!==void 0?i:!1,this.maxStrLength=(n=e?.maxStrLength)!==null&&n!==void 0?n:S,this.maxBinLength=(s=e?.maxBinLength)!==null&&s!==void 0?s:S,this.maxArrayLength=(o=e?.maxArrayLength)!==null&&o!==void 0?o:S,this.maxMapLength=(f=e?.maxMapLength)!==null&&f!==void 0?f:S,this.maxExtLength=(c=e?.maxExtLength)!==null&&c!==void 0?c:S,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:Ae}return r.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=T,this.stack.length=0},r.prototype.setBuffer=function(e){this.bytes=I(e),this.view=de(this.bytes),this.pos=0},r.prototype.appendBuffer=function(e){if(this.headByte===T&&!this.hasRemaining(1))this.setBuffer(e);else{var t=this.bytes.subarray(this.pos),i=I(e),n=new Uint8Array(t.length+i.length);n.set(t),n.set(i,t.length),this.setBuffer(n)}},r.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},r.prototype.createExtraByteError=function(e){var t=this,i=t.view,n=t.pos;return new RangeError("Extra ".concat(i.byteLength-n," of ").concat(i.byteLength," byte(s) found at buffer[").concat(e,"]"))},r.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},r.prototype.decodeMulti=function(e){return M(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}})},r.prototype.decodeAsync=function(e){var t,i,n,s,o,f,c;return me(this,void 0,void 0,function(){var a,u,d,h,p,x,m,l;return M(this,function(v){switch(v.label){case 0:a=!1,v.label=1;case 1:v.trys.push([1,6,7,12]),t=!0,i=F(e),v.label=2;case 2:return[4,i.next()];case 3:if(n=v.sent(),s=n.done,!!s)return[3,5];c=n.value,t=!1;try{if(d=c,a)throw this.createExtraByteError(this.totalPos);this.appendBuffer(d);try{u=this.doDecodeSync(),a=!0}catch(P){if(!(P instanceof k))throw P}this.totalPos+=this.pos}finally{t=!0}v.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return h=v.sent(),o={error:h},[3,12];case 7:return v.trys.push([7,,10,11]),!t&&!s&&(f=i.return)?[4,f.call(i)]:[3,9];case 8:v.sent(),v.label=9;case 9:return[3,11];case 10:if(o)throw o.error;return[7];case 11:return[7];case 12:if(a){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,u]}throw p=this,x=p.headByte,m=p.pos,l=p.totalPos,new RangeError("Insufficient data in parsing ".concat(D(x)," at ").concat(l," (").concat(m," in the current buffer)"))}})})},r.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},r.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},r.prototype.decodeMultiAsync=function(e,t){return Ee(this,arguments,function(){var n,s,o,f,c,a,u,d,h,p,x,m;return M(this,function(l){switch(l.label){case 0:n=t,s=-1,l.label=1;case 1:l.trys.push([1,15,16,21]),o=!0,f=F(e),l.label=2;case 2:return[4,E(f.next())];case 3:if(c=l.sent(),h=c.done,!!h)return[3,14];m=c.value,o=!1,l.label=4;case 4:if(l.trys.push([4,,12,13]),a=m,t&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),n&&(s=this.readArraySize(),n=!1,this.complete()),l.label=5;case 5:l.trys.push([5,10,,11]),l.label=6;case 6:return[4,E(this.doDecodeSync())];case 7:return[4,l.sent()];case 8:return l.sent(),--s===0?[3,9]:[3,6];case 9:return[3,11];case 10:if(u=l.sent(),!(u instanceof k))throw u;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return o=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return d=l.sent(),p={error:d},[3,21];case 16:return l.trys.push([16,,19,20]),!o&&!h&&(x=f.return)?[4,E(x.call(f))]:[3,18];case 17:l.sent(),l.label=18;case 18:return[3,20];case 19:if(p)throw p.error;return[7];case 20:return[7];case 21:return[2]}})})},r.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else t={}}else if(e<160){var i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else t=[]}else{var n=e-160;t=this.decodeUtf8String(n,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)this.useBigInt64?t=this.readU64AsBigInt():t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)this.useBigInt64?t=this.readI64AsBigInt():t=this.readI64();else if(e===217){var n=this.lookU8();t=this.decodeUtf8String(n,1)}else if(e===218){var n=this.lookU16();t=this.decodeUtf8String(n,2)}else if(e===219){var n=this.lookU32();t=this.decodeUtf8String(n,4)}else if(e===220){var i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else t=[]}else if(e===221){var i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else t=[]}else if(e===222){var i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else t={}}else if(e===223){var i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else t={}}else if(e===196){var i=this.lookU8();t=this.decodeBinary(i,1)}else if(e===197){var i=this.lookU16();t=this.decodeBinary(i,2)}else if(e===198){var i=this.lookU32();t=this.decodeBinary(i,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){var i=this.lookU8();t=this.decodeExtension(i,1)}else if(e===200){var i=this.lookU16();t=this.decodeExtension(i,2)}else if(e===201){var i=this.lookU32();t=this.decodeExtension(i,4)}else throw new y("Unrecognized type byte: ".concat(D(e)));this.complete();for(var s=this.stack;s.length>0;){var o=s[s.length-1];if(o.type===L)if(o.array[o.position]=t,o.position++,o.position===o.size)s.pop(),t=o.array;else continue e;else if(o.type===A){if(!Te(t))throw new y("The type of key must be string or number but "+typeof t);if(t==="__proto__")throw new y("The key __proto__ is not allowed");o.key=t,o.type=Se;continue e}else if(o.map[o.key]=t,o.readCount++,o.readCount===o.size)s.pop(),t=o.map;else{o.key=null,o.type=A;continue e}}return t}},r.prototype.readHeadByte=function(){return this.headByte===T&&(this.headByte=this.readU8()),this.headByte},r.prototype.complete=function(){this.headByte=T},r.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new y("Unrecognized array type byte: ".concat(D(e)))}}},r.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new y("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:A,size:e,key:null,readCount:0,map:{}})},r.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new y("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:L,size:e,array:new Array(e),position:0})},r.prototype.decodeUtf8String=function(e,t){var i;if(e>this.maxStrLength)throw new y("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw R;var n=this.pos+t,s;return this.stateIsMapKey()&&(!((i=this.keyDecoder)===null||i===void 0)&&i.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,n,e):s=ee(this.bytes,n,e),this.pos+=t+e,s},r.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===A}return!1},r.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new y("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw R;var i=this.pos+t,n=this.bytes.subarray(i,i+e);return this.pos+=t+e,n},r.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new y("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var i=this.view.getInt8(this.pos+t),n=this.decodeBinary(e,t+1);return this.extensionCodec.decode(n,i,this.context)},r.prototype.lookU8=function(){return this.view.getUint8(this.pos)},r.prototype.lookU16=function(){return this.view.getUint16(this.pos)},r.prototype.lookU32=function(){return this.view.getUint32(this.pos)},r.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},r.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},r.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},r.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},r.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},r.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},r.prototype.readU64=function(){var e=ie(this.view,this.pos);return this.pos+=8,e},r.prototype.readI64=function(){var e=O(this.view,this.pos);return this.pos+=8,e},r.prototype.readU64AsBigInt=function(){var e=this.view.getBigUint64(this.pos);return this.pos+=8,e},r.prototype.readI64AsBigInt=function(){var e=this.view.getBigInt64(this.pos);return this.pos+=8,e},r.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},r.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},r}();function Be(r,e){var t=new Ie(e);return t.decode(r)}var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},H={},w=B&&B.__classPrivateFieldGet||function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},z=B&&B.__classPrivateFieldSet||function(r,e,t,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t},g,U;Object.defineProperty(H,"__esModule",{value:!0});class De{constructor(){g.set(this,!1),U.set(this,new Set)}get acquired(){return w(this,g,"f")}acquireAsync({timeout:e}={}){if(!w(this,g,"f"))return z(this,g,!0,"f"),Promise.resolve();if(e==null)return new Promise(n=>{w(this,U,"f").add(n)});let t,i;return Promise.race([new Promise(n=>{t=()=>{clearTimeout(i),n()},w(this,U,"f").add(t)}),new Promise((n,s)=>{i=setTimeout(()=>{w(this,U,"f").delete(t),s(new Error("Timed out waiting for lock"))},e)})])}tryAcquire(){return w(this,g,"f")?!1:(z(this,g,!0,"f"),!0)}release(){if(!w(this,g,"f"))throw new Error("Cannot release an unacquired lock");if(w(this,U,"f").size>0){const[e]=w(this,U,"f");w(this,U,"f").delete(e),e()}else z(this,g,!1,"f")}}var Me=H.default=De;g=new WeakMap,U=new WeakMap;function K(r,e){if(r instanceof ArrayBuffer)e.add(r);else if(r instanceof Uint8Array)e.add(r.buffer);else if(r&&typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&K(r[t],e);return e}{let r=null,e=null;const t=new Me,i=(s,o)=>{self.postMessage(s,o)},n=()=>{e!==null&&e.close(),e=new WebSocket(r);const s=setTimeout(()=>{e?.close()},5e3);e.onopen=()=>{i({type:"connected"}),clearTimeout(s),console.log(`Connected! ${r}`)},e.onclose=o=>{i({type:"closed"}),console.log(`Disconnected! ${r} code=${o.code}`),clearTimeout(s),r!==null&&setTimeout(n,1e3)},e.onmessage=async o=>{const f=new Promise(c=>{o.data.arrayBuffer().then(a=>{c(Be(new Uint8Array(a)))})});await t.acquireAsync({timeout:1e3}).catch(()=>{console.log("Order lock timed out."),t.release()});try{const c=await f,a=K(c,new Set);i({type:"message_batch",messages:c},Array.from(a))}finally{t.acquired&&t.release()}}};self.onmessage=s=>{const o=s.data;o.type==="send"?e.send(ye(o.message)):o.type==="set_server"?(r=o.server,n()):o.type=="close"?(r=null,e!==null&&e.close(),self.close()):console.log(`WebSocket worker: got ${o}, not sure what to do with it!`)}}
